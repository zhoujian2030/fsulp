/*
 * main.c
 *
 *  Created on: Apr 16, 2018
 *      Author: j.zh
 */
#include "CLogger.h"
#include "lteMac.h"
#include "lteMacPhyInterface.h"

unsigned char gLogLevel = 0;

unsigned char gMsgBuffer[2048];

int main(int argc, char* argv[]) {
    LOG_DBG(ULP_LOGGER_NAME, "[%s], main entry\n", __func__);

    // --------------------------
    unsigned char macPdu[] = { 
        0x3D, 0x21, 0x02, 0x21, 0x80, 0x17, 0x1F, // mac header
        0x00, // bsr value
        0x00, 0x08, // rlc status pdu
        0xa0, 0x01, // rlc data pdu header
        0x01,  // pdcp header
        0x48, 0x02, 0x22, 0xfd, 0xf9, 0x33, 0x37, 0xa2, 0xa0, 0xea, 
        0xc1, 0x09, 0x20, 0xc6, 0x02, 0x00, 0x00, 0x10, 0x24, 0xa0}; 

    // ---------------------------
    unsigned char macPdu1[] = {
        0x3D, 0x21, 0x02, 0x01, 0x01, 0x00, 0x04, 0x88, 0x02, 0x01, 
        0x48, 0x01, 0x60, 0xEA, 0xC1, 0x09, 0x20, 0xC8
    };
    unsigned char macPdu2[] = {
        0x3F, 0x3E, 0x01, 0x00, 0x00, 0x00, 0xB0, 0x03, 0x02, 0x26, 
        0x80, 0xF2, 0x4E, 0x80, 0x00, 0x00, 0x00, 0x00
    };

    // --------------------------
    unsigned char macPdu3[] = {
        0x3D, 0x21, 0x02, 0x21, 0x15, 0x1F, 0x00, 0x00, 0x04, 0xA0, 
        0x01, 0x01, 0x48, 0x01, 0x60, 0xEA, 0xC1, 0x09, 0x20, 0xC8,
        0x02, 0x26, 0x80, 0xF2, 0x4E, 0x80, 0x00, 0x00, 0x00, 0x00,
        0x04, 0x03, 0xA0, 0x62, 0x4E, 0x3B, 0x01, 0x00, 0x42, 0x20,
        0x02, 0x02, 0x00, 0x21, 0x02, 0x0C, 0x00, 0x00, 0x00, 0x01, 
        0x06, 0x0C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00,
        0x06, 0x00, 0x00, 0x14, 0x00, 0xB8, 0x40, 0x00, 0xBA, 0x02, 
        0x08, 0x00, 0x00, 0x00, 0x00, 0x3B, 0x8E, 0x8A, 0x41, 0x2B,
        0xF3, 0x53, 0x24, 0x5A, 0x1F
    };

    unsigned short length = 0;
    RxUlSchInd* pRxUlSchInd = (RxUlSchInd*)gMsgBuffer;
    pRxUlSchInd->sfn = 501;
    pRxUlSchInd->sf = 7;
    pRxUlSchInd->numOfPDUs = 1;
    length += UL_SCH_IND_MSG_HEADER_LEN;

    UlSchPdu* pUlSchPdu = (UlSchPdu*)pRxUlSchInd->buffer;
    pUlSchPdu->rnti = 124;
    pUlSchPdu->length = sizeof(macPdu3);    
    length += UL_SCH_PDU_HEADER_LENGTH;

    memcpy(pUlSchPdu->buffer, macPdu3, pUlSchPdu->length);
    length += pUlSchPdu->length;

    MacUlSchDataInd(gMsgBuffer, length);

    return 1;
}
